{"version":3,"file":"../../js/welcome.js","names":["ipLocation","fetchIPInfo","savedData","localStorage","getItem","savedTimestamp","now","Date","getTime","parseInt","JSON","parse","showWelcome","fetch","then","response","ok","Error","json","data","code","setItem","stringify","toString","catch","error","country","prov","city","district","lat","lng","ip","e","getDistance","e1","n1","e2","n2","sin","cos","asin","PI","hypot","Math","getPoint","n","x","y","z","a","b","r","round","welcomeInfoElement","document","getElementById","posdesc","timeChange","pos","dist","includes","date","getHours","distText","toFixed","innerHTML","handlePjaxComplete","readyState","addEventListener"],"sources":["js/welcome.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// 使用 localStorage 来保存 IP 信息\nlet ipLocation = null;\n\nfunction fetchIPInfo() {\n  // 检查 localStorage 中是否已有数据，且数据未过期\n  const savedData = localStorage.getItem('ipLocationData');\n  const savedTimestamp = localStorage.getItem('ipLocationTimestamp');\n  const now = new Date().getTime();\n\n  // 如果有保存的数据且未超过1小时，直接使用\n  if (savedData && savedTimestamp && (now - parseInt(savedTimestamp) < 3600000)) {\n    ipLocation = JSON.parse(savedData);\n    showWelcome();\n    return;\n  }\n\n  // 否则重新请求\n  fetch('https://api.nsmao.net/api/ip/query?key=YJLRvE0u5W1hww4uuOVnlzdeQ4')\n      .then(response => {\n        if (!response.ok) {\n          throw new Error('Network response was not ok');\n        }\n        return response.json();\n      })\n      .then(data => {\n        ipLocation = data;\n        if (ipLocation.code === 500) {\n          throw new Error('Failed to obtain location information');\n        }\n        // 保存到 localStorage，同时保存时间戳\n        localStorage.setItem('ipLocationData', JSON.stringify(data));\n        localStorage.setItem('ipLocationTimestamp', new Date().getTime().toString());\n        showWelcome();\n      })\n      .catch(error => {\n        ipLocation = {\n          data: {\n            country: '神秘地区',\n            prov: '神秘地区',\n            city: '',\n            district: '',\n            lat: 0,\n            lng: 0\n          },\n          ip: ''\n        };\n\n        // 如果有保存的数据，尝试使用保存的数据\n        if (savedData) {\n          try {\n            ipLocation = JSON.parse(savedData);\n          } catch (e) {}\n        }\n        showWelcome();\n      });\n}\n\nfunction getDistance(e1, n1, e2, n2) {\n  // 如果是神秘地区，直接返回'N'\n  if (e2 === 0 && n2 === 0) {\n    return 'N';\n  }\n\n  const R = 6371;\n  const { sin, cos, asin, PI, hypot } = Math;\n  let getPoint = (e, n) => {\n    e *= PI / 180;\n    n *= PI / 180;\n    return { x: cos(n) * cos(e), y: cos(n) * sin(e), z: sin(n) };\n  };\n\n  let a = getPoint(e1, n1);\n  let b = getPoint(e2, n2);\n  let c = hypot(a.x - b.x, a.y - b.y, a.z - b.z);\n  let r = asin(c / 2) * 2 * R;\n  return Math.round(r);\n}\n\nfunction showWelcome() {\n  let welcomeInfoElement = document.getElementById(\"welcome-info\");\n  if (!welcomeInfoElement || !ipLocation || !ipLocation.data) {\n    return;\n  }\n\n  let pos = ipLocation.data.country;\n  let dist = getDistance(119.306239, 26.075302, ipLocation.data.lng, ipLocation.data.lat);\n  let ip = ipLocation.ip;\n\n  // 处理IPv6的情况\n  if (ip && ip.includes(\":\")) {\n    ip = \"<br>好复杂，咱看不懂~(ipv6)\";\n  }\n\n  let posdesc;\n\n  // 以下的代码需要根据新API返回的结果进行相应的调整\n  switch (ipLocation.data.country) {\n    case \"日本\":\n      posdesc = \"よろしく，一起去看樱花吗\";\n      break;\n    case \"美国\":\n      posdesc = \"Let us live in peace!\";\n      break;\n    case \"英国\":\n      posdesc = \"想同你一起夜乘伦敦眼\";\n      break;\n    case \"俄罗斯\":\n      posdesc = \"干了这瓶伏特加！\";\n      break;\n    case \"法国\":\n      posdesc = \"C'est La Vie\";\n      break;\n    case \"德国\":\n      posdesc = \"Die Zeit verging im Fluge.\";\n      break;\n    case \"澳大利亚\":\n      posdesc = \"一起去大堡礁吧！\";\n      break;\n    case \"加拿大\":\n      posdesc = \"拾起一片枫叶赠予你\";\n      break;\n    case \"中国\":\n      pos = ipLocation.data.prov + \" \" + ipLocation.data.city + \" \" + ipLocation.data.district;\n      switch (ipLocation.data.prov) {\n        case \"北京市\":\n          posdesc = \"北——京——欢迎你~~~\";\n          break;\n        case \"天津市\":\n          posdesc = \"讲段相声吧\";\n          break;\n        case \"河北省\":\n          posdesc = \"山势巍巍成壁垒，天下雄关铁马金戈由此向，无限江山\";\n          break;\n        case \"山西省\":\n          posdesc = \"展开坐具长三尺，已占山河五百余\";\n          break;\n        case \"内蒙古自治区\":\n          posdesc = \"天苍苍，野茫茫，风吹草低见牛羊\";\n          break;\n        case \"辽宁省\":\n          posdesc = \"我想吃烤鸡架！\";\n          break;\n        case \"吉林省\":\n          posdesc = \"状元阁就是东北烧烤之王\";\n          break;\n        case \"黑龙江省\":\n          posdesc = \"很喜欢哈尔滨大剧院\";\n          break;\n        case \"上海市\":\n          posdesc = \"众所周知，中国只有两个城市\";\n          break;\n        case \"江苏省\":\n          switch (ipLocation.data.city) {\n            case \"南京市\":\n              posdesc = \"这是我挺想去的城市啦\";\n              break;\n            case \"苏州市\":\n              posdesc = \"上有天堂，下有苏杭\";\n              break;\n            default:\n              posdesc = \"散装是必须要散装的\";\n              break;\n          }\n          break;\n        case \"浙江省\":\n          switch (ipLocation.data.city) {\n            case \"杭州市\":\n              posdesc = \"东风渐绿西湖柳，雁已还人未南归\";\n              break;\n            default:\n              posdesc = \"望海楼明照曙霞,护江堤白蹋晴沙\";\n              break;\n          }\n          break;\n        case \"河南省\":\n          switch (ipLocation.data.city) {\n            case \"郑州市\":\n              posdesc = \"豫州之域，天地之中\";\n              break;\n            case \"信阳市\":\n              posdesc = \"品信阳毛尖，悟人间芳华\";\n              break;\n            case \"南阳市\":\n              posdesc = \"臣本布衣，躬耕于南阳此南阳非彼南阳！\";\n              break;\n            case \"驻马店市\":\n              posdesc = \"峰峰有奇石，石石挟仙气嵖岈山的花很美哦！\";\n              break;\n            case \"开封市\":\n              posdesc = \"刚正不阿包青天\";\n              break;\n            case \"洛阳市\":\n              posdesc = \"洛阳牡丹甲天下\";\n              break;\n            default:\n              posdesc = \"可否带我品尝河南烩面啦？\";\n              break;\n          }\n          break;\n        case \"安徽省\":\n          posdesc = \"蚌埠住了，芜湖起飞\";\n          break;\n        case \"福建省\":\n          posdesc = \"井邑白云间，岩城远带山\";\n          break;\n        case \"江西省\":\n          posdesc = \"落霞与孤鹜齐飞，秋水共长天一色\";\n          break;\n        case \"山东省\":\n          posdesc = \"遥望齐州九点烟，一泓海水杯中泻\";\n          break;\n        case \"湖北省\":\n          switch (ipLocation.data.city) {\n            case \"黄冈市\":\n              posdesc = \"红安将军县！辈出将才！\";\n              break;\n            default:\n              posdesc = \"来碗热干面~\";\n              break;\n          }\n          break;\n        case \"湖南省\":\n          posdesc = \"74751，长沙斯塔克\";\n          break;\n        case \"广东省\":\n          switch (ipLocation.data.city) {\n            case \"广州市\":\n              posdesc = \"看小蛮腰，喝早茶了嘛~\";\n              break;\n            case \"深圳市\":\n              posdesc = \"今天你逛商场了嘛~\";\n              break;\n            case \"阳江市\":\n              posdesc = \"阳春合水！博主家乡~ 欢迎来玩~\";\n              break;\n            default:\n              posdesc = \"来两斤福建人~\";\n              break;\n          }\n          break;\n        case \"广西壮族自治区\":\n          posdesc = \"桂林山水甲天下\";\n          break;\n        case \"海南省\":\n          posdesc = \"朝观日出逐白浪，夕看云起收霞光\";\n          break;\n        case \"四川省\":\n          posdesc = \"康康川妹子\";\n          break;\n        case \"贵州省\":\n          posdesc = \"茅台，学生，再塞200\";\n          break;\n        case \"云南省\":\n          posdesc = \"玉龙飞舞云缠绕，万仞冰川直耸天\";\n          break;\n        case \"西藏自治区\":\n          posdesc = \"躺在茫茫草原上，仰望蓝天\";\n          break;\n        case \"陕西省\":\n          posdesc = \"来份臊子面加馍\";\n          break;\n        case \"甘肃省\":\n          posdesc = \"羌笛何须怨杨柳，春风不度玉门关\";\n          break;\n        case \"青海省\":\n          posdesc = \"牛肉干和老酸奶都好好吃\";\n          break;\n        case \"宁夏回族自治区\":\n          posdesc = \"大漠孤烟直，长河落日圆\";\n          break;\n        case \"新疆维吾尔自治区\":\n          posdesc = \"驼铃古道丝绸路，胡马犹闻唐汉风\";\n          break;\n        case \"台湾省\":\n          posdesc = \"我在这头，大陆在那头\";\n          break;\n        case \"香港特别行政区\":\n          posdesc = \"永定贼有残留地鬼嚎，迎击光非岁玉\";\n          break;\n        case \"澳门特别行政区\":\n          posdesc = \"性感荷官，在线发牌\";\n          break;\n        default:\n          posdesc = \"带我去你的城市逛逛吧！\";\n          break;\n      }\n      break;\n    default:\n      posdesc = \"带我去你的国家逛逛吧\";\n      break;\n  }\n\n  // 根据本地时间切换欢迎语\n  let timeChange;\n  let date = new Date();\n  if (date.getHours() >= 5 && date.getHours() < 11) timeChange = \"<span>🌤️ 早上好，一日之计在于晨</span>\";\n  else if (date.getHours() >= 11 && date.getHours() < 13) timeChange = \"<span>☀️ 中午好，记得午休喔~</span>\";\n  else if (date.getHours() >= 13 && date.getHours() < 17) timeChange = \"<span>🕞 下午好，饮茶先啦！</span>\";\n  else if (date.getHours() >= 17 && date.getHours() < 19) timeChange = \"<span>🚶‍♂️ 即将下班，记得按时吃饭~</span>\";\n  else if (date.getHours() >= 19 && date.getHours() < 24) timeChange = \"<span>🌙 晚上好，夜生活嗨起来！</span>\";\n  else timeChange = \"夜深了，早点休息，少熬夜\";\n\n  const distText = dist === 'N' ? 'N' : `${dist.toFixed(2)}`;\n\n  if (welcomeInfoElement) {\n    welcomeInfoElement.innerHTML =\n        `欢迎来自 <b><span style=\"color: var(--anzhiyu-main)\">${pos}</span></b> 的小友💖<br>当前位置距博主约 <b><span style=\"color: var(--anzhiyu-main)\">${distText}</span></b> 公里！<br>${timeChange}<br>Tip：<b><span style=\"font-size: 15px;\">${posdesc || \"带我去你的城市逛逛吧！\"}</span></b>`;\n  }\n}\n\n// PJAX 完成时的处理函数\nfunction handlePjaxComplete() {\n  if (!ipLocation) {\n    fetchIPInfo();\n  } else {\n    showWelcome();\n  }\n}\n\n// 确保在非PJAX环境下也能工作\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', function() {\n    fetchIPInfo();\n    document.addEventListener(\"pjax:complete\", handlePjaxComplete);\n  });\n} else {\n  fetchIPInfo();\n  document.addEventListener(\"pjax:complete\", handlePjaxComplete);\n}"]}