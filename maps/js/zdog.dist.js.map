{"version":3,"file":"../../js/zdog.dist.js","names":["root","factory","module","exports","Zdog","this","TAU","Math","PI","extend","a","b","prop","lerp","alpha","modulo","num","div","powerMultipliers","easeInOut","power","isFirstHalf","max","min","slope","curve","CanvasRenderer","isCanvas","ctx","beginPath","elem","point","moveTo","x","y","lineTo","cp0","cp1","end","bezierCurveTo","closePath","pathCommands","isClosed","begin","forEach","command","render","isStroke","color","lineWidth","strokeStyle","stroke","isFill","fillStyle","fill","SvgRenderer","isSvg","round","getPointString","move","svg","line","bezier","setPath","pathValue","setAttribute","renderPath","fillColor","appendChild","require","Vector","utils","position","set","rotateProperty","vec","angle","propA","propB","cos","sin","getMagnitudeSqrt","sum","abs","sqrt","prototype","pos","z","write","undefined","rotate","rotation","rotateZ","rotateY","rotateX","isSame","add","subtract","multiply","transform","translation","scale","magnitude","magnitude2d","copy","Anchor","onePoint","options","create","children","constructor","defaults","setOptions","translate","origin","renderOrigin","addTo","addChild","optionKeys","Object","keys","concat","key","indexOf","shape","remove","push","removeChild","index","splice","update","reset","child","updateGraph","updateFlatGraph","flatGraph","item","updateSortValue","sort","shapeSorter","sortValue","defineProperty","get","_flatGraph","graph","getFlatGraph","addChildFlatGraph","childFlatGraph","Array","apply","renderGraphCanvas","Error","renderGraphSvg","itemOptions","ItemClass","copyGraph","clone","normalizeRotate","subclass","getSubclass","Super","Item","slice","Dragger","hasWindow","window","downEvent","moveEvent","upEvent","noop","PointerEvent","onDragStart","onDragMove","onDragEnd","bindDrag","startElement","element","getQueryElement","style","touchAction","addEventListener","document","querySelector","handleEvent","event","method","type","call","onmousedown","onpointerdown","dragStart","ontouchstart","changedTouches","pointer","preventDefault","dragStartX","pageX","dragStartY","pageY","ontouchmove","dragMove","onmousemove","onpointermove","moveX","moveY","onmouseup","onpointerup","ontouchend","dragEnd","removeEventListener","Illustration","centered","zoom","dragRotate","resize","onPrerender","onResize","setElement","setDragRotate","setResize","nodeName","toLowerCase","setCanvas","setSvg","setSize","width","height","setSizeCanvas","setSizeSvg","resizeListener","onWindowResize","bind","setMeasuredSize","innerWidth","innerHeight","rect","getBoundingClientRect","renderGraph","updateRenderGraph","getContext","pixelRatio","devicePixelRatio","canvasWidth","canvasHeight","prerenderCanvas","postrenderCanvas","lineCap","lineJoin","clearRect","save","centerX","centerY","restore","getAttribute","viewWidth","viewHeight","viewX","viewY","removeAttribute","firstChild","empty","dragStartRX","dragStartRY","arguments","displaySize","moveRY","moveRX","PathCommand","points","previousPoint","map","mapVectorPoint","renderPoints","mapNewVector","endRenderPoint","length","controlPoints","renderPoint","i","renderer","arcHandleLength","arc","prev","corner","Shape","closed","visible","path","front","backface","updatePath","renderFront","renderNormal","actionNames","updatePathCommands","pathPart","isLineOrMove","isPointsArray","isArray","pointCount","firstPoint","lastPoint","sortValueTotal","isFacingBack","isDot","renderCanvasDot","getLineWidth","getRenderColor","radius","getRenderElement","svgElement","createElementNS","Group","updateSort","Rect","RoundedRect","cornerRadius","xA","yA","shortSide","xB","yB","Ellipse","diameter","quarters","Polygon","sides","theta","Hemisphere","apex","renderCentroid","renderDome","getDomeRenderElement","contourAngle","atan2","domeRadius","startAngle","endAngle","domeSvgElement","Cylinder","CylinderGroup","renderCylinderSurface","frontBase","rearBase","strokeWidth","frontFace","group","baseZ","baseColor","property","_prop","value","Cone","renderApex","tangentA","tangentB","surfacePathCommands","renderConeSurface","apexDistance","normalDistance","eccenAngle","acos","eccen","apexAngle","projectLength","projectAngle","setSurfaceRenderPoint","getSurfaceRenderElement","surfaceSvgElement","Box","BoxRect","faceNames","boxDefaults","faceName","depth","_faceName","setFace","rectProperty","getFaceOptions","rearFace","leftFace","rightFace","topFace","bottomFace","isFaceColor","define","amd"],"sources":["js/zdog.dist.js"],"mappings":"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","ignoreList":[],"sourcesContent":["/*!\n * Zdog v1.1.1\n * Round, flat, designer-friendly pseudo-3D engine\n * Licensed MIT\n * https://zzz.dog\n * Copyright 2019 Metafizzy\n */\n\n/**\n * Boilerplate & utils\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory();\n  } else {\n    // browser global\n    root.Zdog = factory();\n  }\n}( this, function factory() {\n\nvar Zdog = {};\n\nZdog.TAU = Math.PI * 2;\n\nZdog.extend = function( a, b ) {\n  for ( var prop in b ) {\n    a[ prop ] = b[ prop ];\n  }\n  return a;\n};\n\nZdog.lerp = function( a, b, alpha ) {\n  return ( b - a ) * alpha + a;\n};\n\nZdog.modulo = function( num, div ) {\n  return ( ( num % div ) + div ) % div;\n};\n\nvar powerMultipliers = {\n  2: function( a ) {\n    return a * a;\n  },\n  3: function( a ) {\n    return a * a * a;\n  },\n  4: function( a ) {\n    return a * a * a * a;\n  },\n  5: function( a ) {\n    return a * a * a * a * a;\n  },\n};\n\nZdog.easeInOut = function( alpha, power ) {\n  if ( power == 1 ) {\n    return alpha;\n  }\n  alpha = Math.max( 0, Math.min( 1, alpha ) );\n  var isFirstHalf = alpha < 0.5;\n  var slope = isFirstHalf ? alpha : 1 - alpha;\n  slope /= 0.5;\n  // make easing steeper with more multiples\n  var powerMultiplier = powerMultipliers[ power ] || powerMultipliers[2];\n  var curve = powerMultiplier( slope );\n  curve /= 2;\n  return isFirstHalf ? curve : 1 - curve;\n};\n\nreturn Zdog;\n\n}));\n/**\n * CanvasRenderer\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory();\n  } else {\n    // browser global\n    root.Zdog.CanvasRenderer = factory();\n  }\n}( this, function factory() {\n\nvar CanvasRenderer = { isCanvas: true };\n\nCanvasRenderer.begin = function( ctx ) {\n  ctx.beginPath();\n};\n\nCanvasRenderer.move = function( ctx, elem, point ) {\n  ctx.moveTo( point.x, point.y );\n};\n\nCanvasRenderer.line = function( ctx, elem, point ) {\n  ctx.lineTo( point.x, point.y );\n};\n\nCanvasRenderer.bezier = function( ctx, elem, cp0, cp1, end ) {\n  ctx.bezierCurveTo( cp0.x, cp0.y, cp1.x, cp1.y, end.x, end.y );\n};\n\nCanvasRenderer.closePath = function( ctx ) {\n  ctx.closePath();\n};\n\nCanvasRenderer.setPath = function() {};\n\nCanvasRenderer.renderPath = function( ctx, elem, pathCommands, isClosed ) {\n  this.begin( ctx, elem );\n  pathCommands.forEach( function( command ) {\n    command.render( ctx, elem, CanvasRenderer );\n  });\n  if ( isClosed ) {\n    this.closePath( ctx, elem );\n  }\n};\n\nCanvasRenderer.stroke = function( ctx, elem, isStroke, color, lineWidth ) {\n  if ( !isStroke ) {\n    return;\n  }\n  ctx.strokeStyle = color;\n  ctx.lineWidth = lineWidth;\n  ctx.stroke();\n};\n\nCanvasRenderer.fill = function( ctx, elem, isFill, color ) {\n  if ( !isFill ) {\n    return;\n  }\n  ctx.fillStyle = color;\n  ctx.fill();\n};\n\nCanvasRenderer.end = function() {};\n\nreturn CanvasRenderer;\n\n}));\n/**\n * SvgRenderer\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory();\n  } else {\n    // browser global\n    root.Zdog.SvgRenderer = factory();\n  }\n}( this, function factory() {\n\nvar SvgRenderer = { isSvg: true };\n\n// round path coordinates to 3 decimals\nvar round = SvgRenderer.round = function( num ) {\n  return Math.round( num * 1000 ) / 1000;\n};\n\nfunction getPointString( point ) {\n  return round( point.x ) + ',' + round( point.y ) + ' ';\n}\n\nSvgRenderer.begin = function() {};\n\nSvgRenderer.move = function( svg, elem, point ) {\n  return 'M' + getPointString( point );\n};\n\nSvgRenderer.line = function( svg, elem, point ) {\n  return 'L' + getPointString( point );\n};\n\nSvgRenderer.bezier = function( svg, elem, cp0, cp1, end ) {\n  return 'C' + getPointString( cp0 ) + getPointString( cp1 ) +\n    getPointString( end );\n};\n\nSvgRenderer.closePath = function(/* elem */) {\n  return 'Z';\n};\n\nSvgRenderer.setPath = function( svg, elem, pathValue ) {\n  elem.setAttribute( 'd', pathValue );\n};\n\nSvgRenderer.renderPath = function( svg, elem, pathCommands, isClosed ) {\n  var pathValue = '';\n  pathCommands.forEach( function( command ) {\n    pathValue += command.render( svg, elem, SvgRenderer );\n  });\n  if ( isClosed ) {\n    pathValue += this.closePath( svg, elem );\n  }\n  this.setPath( svg, elem, pathValue );\n};\n\nSvgRenderer.stroke = function( svg, elem, isStroke, color, lineWidth ) {\n  if ( !isStroke ) {\n    return;\n  }\n  elem.setAttribute( 'stroke', color );\n  elem.setAttribute( 'stroke-width', lineWidth );\n};\n\nSvgRenderer.fill = function( svg, elem, isFill, color ) {\n  var fillColor = isFill ? color : 'none';\n  elem.setAttribute( 'fill', fillColor );\n};\n\nSvgRenderer.end = function( svg, elem ) {\n  svg.appendChild( elem );\n};\n\nreturn SvgRenderer;\n\n}));\n/**\n * Vector\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory( require('./boilerplate') );\n  } else {\n    // browser global\n    var Zdog = root.Zdog;\n    Zdog.Vector = factory( Zdog );\n  }\n\n}( this, function factory( utils ) {\n\nfunction Vector( position ) {\n  this.set( position );\n}\n\nvar TAU = utils.TAU;\n\n// 'pos' = 'position'\nVector.prototype.set = function( pos ) {\n  this.x = pos && pos.x || 0;\n  this.y = pos && pos.y || 0;\n  this.z = pos && pos.z || 0;\n  return this;\n};\n\n// set coordinates without sanitizing\n// vec.write({ y: 2 }) only sets y coord\nVector.prototype.write = function( pos ) {\n  if ( !pos ) {\n    return this;\n  }\n  this.x = pos.x != undefined ? pos.x : this.x;\n  this.y = pos.y != undefined ? pos.y : this.y;\n  this.z = pos.z != undefined ? pos.z : this.z;\n  return this;\n};\n\nVector.prototype.rotate = function( rotation ) {\n  if ( !rotation ) {\n    return;\n  }\n  this.rotateZ( rotation.z );\n  this.rotateY( rotation.y );\n  this.rotateX( rotation.x );\n  return this;\n};\n\nVector.prototype.rotateZ = function( angle ) {\n  rotateProperty( this, angle, 'x', 'y' );\n};\n\nVector.prototype.rotateX = function( angle ) {\n  rotateProperty( this, angle, 'y', 'z' );\n};\n\nVector.prototype.rotateY = function( angle ) {\n  rotateProperty( this, angle, 'x', 'z' );\n};\n\nfunction rotateProperty( vec, angle, propA, propB ) {\n  if ( !angle || angle % TAU === 0 ) {\n    return;\n  }\n  var cos = Math.cos( angle );\n  var sin = Math.sin( angle );\n  var a = vec[ propA ];\n  var b = vec[ propB ];\n  vec[ propA ] = a*cos - b*sin;\n  vec[ propB ] = b*cos + a*sin;\n}\n\nVector.prototype.isSame = function( pos ) {\n  if ( !pos ) {\n    return false;\n  }\n  return this.x === pos.x && this.y === pos.y && this.z === pos.z;\n};\n\nVector.prototype.add = function( pos ) {\n  if ( !pos ) {\n    return this;\n  }\n  this.x += pos.x || 0;\n  this.y += pos.y || 0;\n  this.z += pos.z || 0;\n  return this;\n};\n\nVector.prototype.subtract = function( pos ) {\n  if ( !pos ) {\n    return this;\n  }\n  this.x -= pos.x || 0;\n  this.y -= pos.y || 0;\n  this.z -= pos.z || 0;\n  return this;\n};\n\nVector.prototype.multiply = function( pos ) {\n  if ( pos == undefined ) {\n    return this;\n  }\n  // multiple all values by same number\n  if ( typeof pos == 'number' ) {\n    this.x *= pos;\n    this.y *= pos;\n    this.z *= pos;\n  } else {\n    // multiply object\n    this.x *= pos.x != undefined ? pos.x : 1;\n    this.y *= pos.y != undefined ? pos.y : 1;\n    this.z *= pos.z != undefined ? pos.z : 1;\n  }\n  return this;\n};\n\nVector.prototype.transform = function( translation, rotation, scale ) {\n  this.multiply( scale );\n  this.rotate( rotation );\n  this.add( translation );\n  return this;\n};\n\nVector.prototype.lerp = function( pos, alpha ) {\n  this.x = utils.lerp( this.x, pos.x || 0, alpha );\n  this.y = utils.lerp( this.y, pos.y || 0, alpha );\n  this.z = utils.lerp( this.z, pos.z || 0, alpha );\n  return this;\n};\n\nVector.prototype.magnitude = function() {\n  var sum = this.x*this.x + this.y*this.y + this.z*this.z;\n  return getMagnitudeSqrt( sum );\n};\n\nfunction getMagnitudeSqrt( sum ) {\n  // PERF: check if sum ~= 1 and skip sqrt\n  if ( Math.abs( sum - 1 ) < 0.00000001 ) {\n    return 1;\n  }\n  return Math.sqrt( sum );\n}\n\nVector.prototype.magnitude2d = function() {\n  var sum = this.x*this.x + this.y*this.y;\n  return getMagnitudeSqrt( sum );\n};\n\nVector.prototype.copy = function() {\n  return new Vector( this );\n};\n\nreturn Vector;\n\n}));\n/**\n * Anchor\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory( require('./boilerplate'), require('./vector'),\n        require('./canvas-renderer'), require('./svg-renderer') );\n  } else {\n    // browser global\n    var Zdog = root.Zdog;\n    Zdog.Anchor = factory( Zdog, Zdog.Vector, Zdog.CanvasRenderer,\n        Zdog.SvgRenderer );\n  }\n}( this, function factory( utils, Vector, CanvasRenderer, SvgRenderer ) {\n\nvar TAU = utils.TAU;\nvar onePoint = { x: 1, y: 1, z: 1 };\n\nfunction Anchor( options ) {\n  this.create( options || {} );\n}\n\nAnchor.prototype.create = function( options ) {\n  this.children = [];\n  // set defaults & options\n  utils.extend( this, this.constructor.defaults );\n  this.setOptions( options );\n\n  // transform\n  this.translate = new Vector( options.translate );\n  this.rotate = new Vector( options.rotate );\n  this.scale = new Vector( onePoint ).multiply( this.scale );\n  // origin\n  this.origin = new Vector();\n  this.renderOrigin = new Vector();\n\n  if ( this.addTo ) {\n    this.addTo.addChild( this );\n  }\n};\n\nAnchor.defaults = {};\n\nAnchor.optionKeys = Object.keys( Anchor.defaults ).concat([\n  'rotate',\n  'translate',\n  'scale',\n  'addTo',\n]);\n\nAnchor.prototype.setOptions = function( options ) {\n  var optionKeys = this.constructor.optionKeys;\n\n  for ( var key in options ) {\n    if ( optionKeys.indexOf( key ) != -1 ) {\n      this[ key ] = options[ key ];\n    }\n  }\n};\n\nAnchor.prototype.addChild = function( shape ) {\n  if ( this.children.indexOf( shape ) != -1 ) {\n    return;\n  }\n  shape.remove(); // remove previous parent\n  shape.addTo = this; // keep parent reference\n  this.children.push( shape );\n};\n\nAnchor.prototype.removeChild = function( shape ) {\n  var index = this.children.indexOf( shape );\n  if ( index != -1 ) {\n    this.children.splice( index, 1 );\n  }\n};\n\nAnchor.prototype.remove = function() {\n  if ( this.addTo ) {\n    this.addTo.removeChild( this );\n  }\n};\n\n// ----- update ----- //\n\nAnchor.prototype.update = function() {\n  // update self\n  this.reset();\n  // update children\n  this.children.forEach( function( child ) {\n    child.update();\n  });\n  this.transform( this.translate, this.rotate, this.scale );\n};\n\nAnchor.prototype.reset = function() {\n  this.renderOrigin.set( this.origin );\n};\n\nAnchor.prototype.transform = function( translation, rotation, scale ) {\n  this.renderOrigin.transform( translation, rotation, scale );\n  // transform children\n  this.children.forEach( function( child ) {\n    child.transform( translation, rotation, scale );\n  });\n};\n\nAnchor.prototype.updateGraph = function() {\n  this.update();\n  this.updateFlatGraph();\n  this.flatGraph.forEach( function( item ) {\n    item.updateSortValue();\n  });\n  // z-sort\n  this.flatGraph.sort( Anchor.shapeSorter );\n};\n\nAnchor.shapeSorter = function( a, b ) {\n  return a.sortValue - b.sortValue;\n};\n\n// custom getter to check for flatGraph before using it\nObject.defineProperty( Anchor.prototype, 'flatGraph', {\n  get: function() {\n    if ( !this._flatGraph ) {\n      this.updateFlatGraph();\n    }\n    return this._flatGraph;\n  },\n  set: function( graph ) {\n    this._flatGraph = graph;\n  },\n});\n\nAnchor.prototype.updateFlatGraph = function() {\n  this.flatGraph = this.getFlatGraph();\n};\n\n// return Array of self & all child graph items\nAnchor.prototype.getFlatGraph = function() {\n  var flatGraph = [ this ];\n  return this.addChildFlatGraph( flatGraph );\n};\n\nAnchor.prototype.addChildFlatGraph = function( flatGraph ) {\n  this.children.forEach( function( child ) {\n    var childFlatGraph = child.getFlatGraph();\n    Array.prototype.push.apply( flatGraph, childFlatGraph );\n  });\n  return flatGraph;\n};\n\nAnchor.prototype.updateSortValue = function() {\n  this.sortValue = this.renderOrigin.z;\n};\n\n// ----- render ----- //\n\nAnchor.prototype.render = function() {};\n\n// TODO refactor out CanvasRenderer so its not a dependency within anchor.js\nAnchor.prototype.renderGraphCanvas = function( ctx ) {\n  if ( !ctx ) {\n    throw new Error( 'ctx is ' + ctx + '. ' +\n      'Canvas context required for render. Check .renderGraphCanvas( ctx ).' );\n  }\n  this.flatGraph.forEach( function( item ) {\n    item.render( ctx, CanvasRenderer );\n  });\n};\n\nAnchor.prototype.renderGraphSvg = function( svg ) {\n  if ( !svg ) {\n    throw new Error( 'svg is ' + svg + '. ' +\n      'SVG required for render. Check .renderGraphSvg( svg ).' );\n  }\n  this.flatGraph.forEach( function( item ) {\n    item.render( svg, SvgRenderer );\n  });\n};\n\n// ----- misc ----- //\n\nAnchor.prototype.copy = function( options ) {\n  // copy options\n  var itemOptions = {};\n  var optionKeys = this.constructor.optionKeys;\n  optionKeys.forEach( function( key ) {\n    itemOptions[ key ] = this[ key ];\n  }, this );\n  // add set options\n  utils.extend( itemOptions, options );\n  var ItemClass = this.constructor;\n  return new ItemClass( itemOptions );\n};\n\nAnchor.prototype.copyGraph = function( options ) {\n  var clone = this.copy( options );\n  this.children.forEach( function( child ) {\n    child.copyGraph({\n      addTo: clone,\n    });\n  });\n  return clone;\n};\n\nAnchor.prototype.normalizeRotate = function() {\n  this.rotate.x = utils.modulo( this.rotate.x, TAU );\n  this.rotate.y = utils.modulo( this.rotate.y, TAU );\n  this.rotate.z = utils.modulo( this.rotate.z, TAU );\n};\n\n// ----- subclass ----- //\n\nfunction getSubclass( Super ) {\n  return function( defaults ) {\n    // create constructor\n    function Item( options ) {\n      this.create( options || {} );\n    }\n\n    Item.prototype = Object.create( Super.prototype );\n    Item.prototype.constructor = Item;\n\n    Item.defaults = utils.extend( {}, Super.defaults );\n    utils.extend( Item.defaults, defaults );\n    // create optionKeys\n    Item.optionKeys = Super.optionKeys.slice(0);\n    // add defaults keys to optionKeys, dedupe\n    Object.keys( Item.defaults ).forEach( function( key ) {\n      if ( !Item.optionKeys.indexOf( key ) != 1 ) {\n        Item.optionKeys.push( key );\n      }\n    });\n\n    Item.subclass = getSubclass( Item );\n\n    return Item;\n  };\n}\n\nAnchor.subclass = getSubclass( Anchor );\n\nreturn Anchor;\n\n}));\n/**\n * Dragger\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory();\n  } else {\n    // browser global\n    root.Zdog.Dragger = factory();\n  }\n}( this, function factory() {\n\n// quick & dirty drag event stuff\n// messes up if multiple pointers/touches\n\n// check for browser window #85\nvar hasWindow = typeof window != 'undefined';\n// event support, default to mouse events\nvar downEvent = 'mousedown';\nvar moveEvent = 'mousemove';\nvar upEvent = 'mouseup';\nif ( hasWindow ) {\n  if ( window.PointerEvent ) {\n    // PointerEvent, Chrome\n    downEvent = 'pointerdown';\n    moveEvent = 'pointermove';\n    upEvent = 'pointerup';\n  } else if ( 'ontouchstart' in window ) {\n    // Touch Events, iOS Safari\n    downEvent = 'touchstart';\n    moveEvent = 'touchmove';\n    upEvent = 'touchend';\n  }\n}\n\nfunction noop() {}\n\nfunction Dragger( options ) {\n  this.create( options || {} );\n}\n\nDragger.prototype.create = function( options ) {\n  this.onDragStart = options.onDragStart || noop;\n  this.onDragMove = options.onDragMove || noop;\n  this.onDragEnd = options.onDragEnd || noop;\n\n  this.bindDrag( options.startElement );\n};\n\nDragger.prototype.bindDrag = function( element ) {\n  element = this.getQueryElement( element );\n  if ( !element ) {\n    return;\n  }\n  // disable browser gestures #53\n  element.style.touchAction = 'none';\n  element.addEventListener( downEvent, this );\n};\n\nDragger.prototype.getQueryElement = function( element ) {\n  if ( typeof element == 'string' ) {\n    // with string, query selector\n    element = document.querySelector( element );\n  }\n  return element;\n};\n\nDragger.prototype.handleEvent = function( event ) {\n  var method = this[ 'on' + event.type ];\n  if ( method ) {\n    method.call( this, event );\n  }\n};\n\nDragger.prototype.onmousedown =\nDragger.prototype.onpointerdown = function( event ) {\n  this.dragStart( event, event );\n};\n\nDragger.prototype.ontouchstart = function( event ) {\n  this.dragStart( event, event.changedTouches[0] );\n};\n\nDragger.prototype.dragStart = function( event, pointer ) {\n  event.preventDefault();\n  this.dragStartX = pointer.pageX;\n  this.dragStartY = pointer.pageY;\n  if ( hasWindow ) {\n    window.addEventListener( moveEvent, this );\n    window.addEventListener( upEvent, this );\n  }\n  this.onDragStart( pointer );\n};\n\nDragger.prototype.ontouchmove = function( event ) {\n  // HACK, moved touch may not be first\n  this.dragMove( event, event.changedTouches[0] );\n};\n\nDragger.prototype.onmousemove =\nDragger.prototype.onpointermove = function( event ) {\n  this.dragMove( event, event );\n};\n\nDragger.prototype.dragMove = function( event, pointer ) {\n  event.preventDefault();\n  var moveX = pointer.pageX - this.dragStartX;\n  var moveY = pointer.pageY - this.dragStartY;\n  this.onDragMove( pointer, moveX, moveY );\n};\n\nDragger.prototype.onmouseup =\nDragger.prototype.onpointerup =\nDragger.prototype.ontouchend =\nDragger.prototype.dragEnd = function(/* event */) {\n  window.removeEventListener( moveEvent, this );\n  window.removeEventListener( upEvent, this );\n  this.onDragEnd();\n};\n\nreturn Dragger;\n\n}));\n/**\n * Illustration\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory( require('./boilerplate'), require('./anchor'),\n        require('./dragger') );\n  } else {\n    // browser global\n    var Zdog = root.Zdog;\n    Zdog.Illustration = factory( Zdog, Zdog.Anchor, Zdog.Dragger );\n  }\n}( this, function factory( utils, Anchor, Dragger ) {\n\nfunction noop() {}\nvar TAU = utils.TAU;\n\nvar Illustration = Anchor.subclass({\n  element: undefined,\n  centered: true,\n  zoom: 1,\n  dragRotate: false,\n  resize: false,\n  onPrerender: noop,\n  onDragStart: noop,\n  onDragMove: noop,\n  onDragEnd: noop,\n  onResize: noop,\n});\n\nutils.extend( Illustration.prototype, Dragger.prototype );\n\nIllustration.prototype.create = function( options ) {\n  Anchor.prototype.create.call( this, options );\n  Dragger.prototype.create.call( this, options );\n  this.setElement( this.element );\n  this.setDragRotate( this.dragRotate );\n  this.setResize( this.resize );\n};\n\nIllustration.prototype.setElement = function( element ) {\n  element = this.getQueryElement( element );\n  if ( !element ) {\n    throw new Error( 'Zdog.Illustration element required. Set to ' + element );\n  }\n\n  var nodeName = element.nodeName.toLowerCase();\n  if ( nodeName == 'canvas' ) {\n    this.setCanvas( element );\n  } else if ( nodeName == 'svg' ) {\n    this.setSvg( element );\n  }\n};\n\nIllustration.prototype.setSize = function( width, height ) {\n  width = Math.round( width );\n  height = Math.round( height );\n  if ( this.isCanvas ) {\n    this.setSizeCanvas( width, height );\n  } else if ( this.isSvg ) {\n    this.setSizeSvg( width, height );\n  }\n};\n\nIllustration.prototype.setResize = function( resize ) {\n  this.resize = resize;\n  // create resize event listener\n  if ( !this.resizeListener ) {\n    this.resizeListener = this.onWindowResize.bind( this );\n  }\n  // add/remove event listener\n  if ( resize ) {\n    window.addEventListener( 'resize', this.resizeListener );\n    this.onWindowResize();\n  } else {\n    window.removeEventListener( 'resize', this.resizeListener );\n  }\n};\n\n// TODO debounce this?\nIllustration.prototype.onWindowResize = function() {\n  this.setMeasuredSize();\n  this.onResize( this.width, this.height );\n};\n\nIllustration.prototype.setMeasuredSize = function() {\n  var width, height;\n  var isFullscreen = this.resize == 'fullscreen';\n  if ( isFullscreen ) {\n    width = window.innerWidth;\n    height = window.innerHeight;\n  } else {\n    var rect = this.element.getBoundingClientRect();\n    width = rect.width;\n    height = rect.height;\n  }\n  this.setSize( width, height );\n};\n\n// ----- render ----- //\n\nIllustration.prototype.renderGraph = function( item ) {\n  if ( this.isCanvas ) {\n    this.renderGraphCanvas( item );\n  } else if ( this.isSvg ) {\n    this.renderGraphSvg( item );\n  }\n};\n\n// combo method\nIllustration.prototype.updateRenderGraph = function( item ) {\n  this.updateGraph();\n  this.renderGraph( item );\n};\n\n// ----- canvas ----- //\n\nIllustration.prototype.setCanvas = function( element ) {\n  this.element = element;\n  this.isCanvas = true;\n  // update related properties\n  this.ctx = this.element.getContext('2d');\n  // set initial size\n  this.setSizeCanvas( element.width, element.height );\n};\n\nIllustration.prototype.setSizeCanvas = function( width, height ) {\n  this.width = width;\n  this.height = height;\n  // up-rez for hi-DPI devices\n  var pixelRatio = this.pixelRatio = window.devicePixelRatio || 1;\n  this.element.width = this.canvasWidth = width * pixelRatio;\n  this.element.height = this.canvasHeight = height * pixelRatio;\n  var needsHighPixelRatioSizing = pixelRatio > 1 && !this.resize;\n  if ( needsHighPixelRatioSizing ) {\n    this.element.style.width = width + 'px';\n    this.element.style.height = height + 'px';\n  }\n};\n\nIllustration.prototype.renderGraphCanvas = function( item ) {\n  item = item || this;\n  this.prerenderCanvas();\n  Anchor.prototype.renderGraphCanvas.call( item, this.ctx );\n  this.postrenderCanvas();\n};\n\nIllustration.prototype.prerenderCanvas = function() {\n  var ctx = this.ctx;\n  ctx.lineCap = 'round';\n  ctx.lineJoin = 'round';\n  ctx.clearRect( 0, 0, this.canvasWidth, this.canvasHeight );\n  ctx.save();\n  if ( this.centered ) {\n    var centerX = this.width/2 * this.pixelRatio;\n    var centerY = this.height/2 * this.pixelRatio;\n    ctx.translate( centerX, centerY );\n  }\n  var scale = this.pixelRatio * this.zoom;\n  ctx.scale( scale, scale );\n  this.onPrerender( ctx );\n};\n\nIllustration.prototype.postrenderCanvas = function() {\n  this.ctx.restore();\n};\n\n// ----- svg ----- //\n\nIllustration.prototype.setSvg = function( element ) {\n  this.element = element;\n  this.isSvg = true;\n  this.pixelRatio = 1;\n  // set initial size from width & height attributes\n  var width = element.getAttribute('width');\n  var height = element.getAttribute('height');\n  this.setSizeSvg( width, height );\n};\n\nIllustration.prototype.setSizeSvg = function( width, height ) {\n  this.width = width;\n  this.height = height;\n  var viewWidth = width / this.zoom;\n  var viewHeight = height / this.zoom;\n  var viewX = this.centered ? -viewWidth/2 : 0;\n  var viewY = this.centered ? -viewHeight/2 : 0;\n  this.element.setAttribute( 'viewBox', viewX + ' ' + viewY + ' ' +\n    viewWidth + ' ' + viewHeight );\n  if ( this.resize ) {\n    // remove size attributes, let size be determined by viewbox\n    this.element.removeAttribute('width');\n    this.element.removeAttribute('height');\n  } else {\n    this.element.setAttribute( 'width', width );\n    this.element.setAttribute( 'height', height );\n  }\n};\n\nIllustration.prototype.renderGraphSvg = function( item ) {\n  item = item || this;\n  empty( this.element );\n  this.onPrerender( this.element );\n  Anchor.prototype.renderGraphSvg.call( item, this.element );\n};\n\nfunction empty( element ) {\n  while ( element.firstChild ) {\n    element.removeChild( element.firstChild );\n  }\n}\n\n// ----- drag ----- //\n\nIllustration.prototype.setDragRotate = function( item ) {\n  if ( !item ) {\n    return;\n  } else if ( item === true ) {\n    /* eslint consistent-this: \"off\" */\n    item = this;\n  }\n  this.dragRotate = item;\n\n  this.bindDrag( this.element );\n};\n\nIllustration.prototype.dragStart = function(/* event, pointer */) {\n  this.dragStartRX = this.dragRotate.rotate.x;\n  this.dragStartRY = this.dragRotate.rotate.y;\n  Dragger.prototype.dragStart.apply( this, arguments );\n};\n\nIllustration.prototype.dragMove = function( event, pointer ) {\n  var moveX = pointer.pageX - this.dragStartX;\n  var moveY = pointer.pageY - this.dragStartY;\n  var displaySize = Math.min( this.width, this.height );\n  var moveRY = moveX / displaySize * TAU;\n  var moveRX = moveY / displaySize * TAU;\n  this.dragRotate.rotate.x = this.dragStartRX - moveRX;\n  this.dragRotate.rotate.y = this.dragStartRY - moveRY;\n  Dragger.prototype.dragMove.apply( this, arguments );\n};\n\nreturn Illustration;\n\n}));\n/**\n * PathCommand\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory( require('./vector') );\n  } else {\n    // browser global\n    var Zdog = root.Zdog;\n    Zdog.PathCommand = factory( Zdog.Vector );\n  }\n}( this, function factory( Vector ) {\n\nfunction PathCommand( method, points, previousPoint ) {\n  this.method = method;\n  this.points = points.map( mapVectorPoint );\n  this.renderPoints = points.map( mapNewVector );\n  this.previousPoint = previousPoint;\n  this.endRenderPoint = this.renderPoints[ this.renderPoints.length - 1 ];\n  // arc actions come with previous point & corner point\n  // but require bezier control points\n  if ( method == 'arc' ) {\n    this.controlPoints = [ new Vector(), new Vector() ];\n  }\n}\n\nfunction mapVectorPoint( point ) {\n  if ( point instanceof Vector ) {\n    return point;\n  } else {\n    return new Vector( point );\n  }\n}\n\nfunction mapNewVector( point ) {\n  return new Vector( point );\n}\n\nPathCommand.prototype.reset = function() {\n  // reset renderPoints back to orignal points position\n  var points = this.points;\n  this.renderPoints.forEach( function( renderPoint, i ) {\n    var point = points[i];\n    renderPoint.set( point );\n  });\n};\n\nPathCommand.prototype.transform = function( translation, rotation, scale ) {\n  this.renderPoints.forEach( function( renderPoint ) {\n    renderPoint.transform( translation, rotation, scale );\n  });\n};\n\nPathCommand.prototype.render = function( ctx, elem, renderer ) {\n  return this[ this.method ]( ctx, elem, renderer );\n};\n\nPathCommand.prototype.move = function( ctx, elem, renderer ) {\n  return renderer.move( ctx, elem, this.renderPoints[0] );\n};\n\nPathCommand.prototype.line = function( ctx, elem, renderer ) {\n  return renderer.line( ctx, elem, this.renderPoints[0] );\n};\n\nPathCommand.prototype.bezier = function( ctx, elem, renderer ) {\n  var cp0 = this.renderPoints[0];\n  var cp1 = this.renderPoints[1];\n  var end = this.renderPoints[2];\n  return renderer.bezier( ctx, elem, cp0, cp1, end );\n};\n\nvar arcHandleLength = 9/16;\n\nPathCommand.prototype.arc = function( ctx, elem, renderer ) {\n  var prev = this.previousPoint;\n  var corner = this.renderPoints[0];\n  var end = this.renderPoints[1];\n  var cp0 = this.controlPoints[0];\n  var cp1 = this.controlPoints[1];\n  cp0.set( prev ).lerp( corner, arcHandleLength );\n  cp1.set( end ).lerp( corner, arcHandleLength );\n  return renderer.bezier( ctx, elem, cp0, cp1, end );\n};\n\nreturn PathCommand;\n\n}));\n/**\n * Shape\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory( require('./boilerplate'), require('./vector'),\n        require('./path-command'), require('./anchor') );\n  } else {\n    // browser global\n    var Zdog = root.Zdog;\n    Zdog.Shape = factory( Zdog, Zdog.Vector, Zdog.PathCommand, Zdog.Anchor );\n  }\n}( this, function factory( utils, Vector, PathCommand, Anchor ) {\n\nvar Shape = Anchor.subclass({\n  stroke: 1,\n  fill: false,\n  color: '#333',\n  closed: true,\n  visible: true,\n  path: [ {} ],\n  front: { z: 1 },\n  backface: true,\n});\n\nShape.prototype.create = function( options ) {\n  Anchor.prototype.create.call( this, options );\n  this.updatePath();\n  // front\n  this.front = new Vector( options.front || this.front );\n  this.renderFront = new Vector( this.front );\n  this.renderNormal = new Vector();\n};\n\nvar actionNames = [\n  'move',\n  'line',\n  'bezier',\n  'arc',\n];\n\nShape.prototype.updatePath = function() {\n  this.setPath();\n  this.updatePathCommands();\n};\n\n// place holder for Ellipse, Rect, etc.\nShape.prototype.setPath = function() {};\n\n// parse path into PathCommands\nShape.prototype.updatePathCommands = function() {\n  var previousPoint;\n  this.pathCommands = this.path.map( function( pathPart, i ) {\n    // pathPart can be just vector coordinates -> { x, y, z }\n    // or path instruction -> { arc: [ {x0,y0,z0}, {x1,y1,z1} ] }\n    var keys = Object.keys( pathPart );\n    var method = keys[0];\n    var points = pathPart[ method ];\n    // default to line if no instruction\n    var isInstruction = keys.length == 1 && actionNames.indexOf( method ) != -1;\n    if ( !isInstruction ) {\n      method = 'line';\n      points = pathPart;\n    }\n    // munge single-point methods like line & move without arrays\n    var isLineOrMove = method == 'line' || method == 'move';\n    var isPointsArray = Array.isArray( points );\n    if ( isLineOrMove && !isPointsArray ) {\n      points = [ points ];\n    }\n\n    // first action is always move\n    method = i === 0 ? 'move' : method;\n    // arcs require previous last point\n    var command = new PathCommand( method, points, previousPoint );\n    // update previousLastPoint\n    previousPoint = command.endRenderPoint;\n    return command;\n  });\n};\n\n// ----- update ----- //\n\nShape.prototype.reset = function() {\n  this.renderOrigin.set( this.origin );\n  this.renderFront.set( this.front );\n  // reset command render points\n  this.pathCommands.forEach( function( command ) {\n    command.reset();\n  });\n};\n\nShape.prototype.transform = function( translation, rotation, scale ) {\n  // calculate render points backface visibility & cone/hemisphere shapes\n  this.renderOrigin.transform( translation, rotation, scale );\n  this.renderFront.transform( translation, rotation, scale );\n  this.renderNormal.set( this.renderOrigin ).subtract( this.renderFront );\n  // transform points\n  this.pathCommands.forEach( function( command ) {\n    command.transform( translation, rotation, scale );\n  });\n  // transform children\n  this.children.forEach( function( child ) {\n    child.transform( translation, rotation, scale );\n  });\n};\n\nShape.prototype.updateSortValue = function() {\n  // sort by average z of all points\n  // def not geometrically correct, but works for me\n  var pointCount = this.pathCommands.length;\n  var firstPoint = this.pathCommands[0].endRenderPoint;\n  var lastPoint = this.pathCommands[ pointCount - 1 ].endRenderPoint;\n  // ignore the final point if self closing shape\n  var isSelfClosing = pointCount > 2 && firstPoint.isSame( lastPoint );\n  if ( isSelfClosing ) {\n    pointCount -= 1;\n  }\n\n  var sortValueTotal = 0;\n  for ( var i = 0; i < pointCount; i++ ) {\n    sortValueTotal += this.pathCommands[i].endRenderPoint.z;\n  }\n  this.sortValue = sortValueTotal / pointCount;\n};\n\n// ----- render ----- //\n\nShape.prototype.render = function( ctx, renderer ) {\n  var length = this.pathCommands.length;\n  if ( !this.visible || !length ) {\n    return;\n  }\n  // do not render if hiding backface\n  this.isFacingBack = this.renderNormal.z > 0;\n  if ( !this.backface && this.isFacingBack ) {\n    return;\n  }\n  if ( !renderer ) {\n    throw new Error( 'Zdog renderer required. Set to ' + renderer );\n  }\n  // render dot or path\n  var isDot = length == 1;\n  if ( renderer.isCanvas && isDot ) {\n    this.renderCanvasDot( ctx, renderer );\n  } else {\n    this.renderPath( ctx, renderer );\n  }\n};\n\nvar TAU = utils.TAU;\n// Safari does not render lines with no size, have to render circle instead\nShape.prototype.renderCanvasDot = function( ctx ) {\n  var lineWidth = this.getLineWidth();\n  if ( !lineWidth ) {\n    return;\n  }\n  ctx.fillStyle = this.getRenderColor();\n  var point = this.pathCommands[0].endRenderPoint;\n  ctx.beginPath();\n  var radius = lineWidth/2;\n  ctx.arc( point.x, point.y, radius, 0, TAU );\n  ctx.fill();\n};\n\nShape.prototype.getLineWidth = function() {\n  if ( !this.stroke ) {\n    return 0;\n  }\n  if ( this.stroke == true ) {\n    return 1;\n  }\n  return this.stroke;\n};\n\nShape.prototype.getRenderColor = function() {\n  // use backface color if applicable\n  var isBackfaceColor = typeof this.backface == 'string' && this.isFacingBack;\n  var color = isBackfaceColor ? this.backface : this.color;\n  return color;\n};\n\nShape.prototype.renderPath = function( ctx, renderer ) {\n  var elem = this.getRenderElement( ctx, renderer );\n  var isTwoPoints = this.pathCommands.length == 2 &&\n    this.pathCommands[1].method == 'line';\n  var isClosed = !isTwoPoints && this.closed;\n  var color = this.getRenderColor();\n\n  renderer.renderPath( ctx, elem, this.pathCommands, isClosed );\n  renderer.stroke( ctx, elem, this.stroke, color, this.getLineWidth() );\n  renderer.fill( ctx, elem, this.fill, color );\n  renderer.end( ctx, elem );\n};\n\nvar svgURI = 'http://www.w3.org/2000/svg';\n\nShape.prototype.getRenderElement = function( ctx, renderer ) {\n  if ( !renderer.isSvg ) {\n    return;\n  }\n  if ( !this.svgElement ) {\n    // create svgElement\n    this.svgElement = document.createElementNS( svgURI, 'path');\n    this.svgElement.setAttribute( 'stroke-linecap', 'round' );\n    this.svgElement.setAttribute( 'stroke-linejoin', 'round' );\n  }\n  return this.svgElement;\n};\n\nreturn Shape;\n\n}));\n/**\n * Group\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory( require('./anchor') );\n  } else {\n    // browser global\n    var Zdog = root.Zdog;\n    Zdog.Group = factory( Zdog.Anchor );\n  }\n}( this, function factory( Anchor ) {\n\nvar Group = Anchor.subclass({\n  updateSort: false,\n  visible: true,\n});\n\n// ----- update ----- //\n\nGroup.prototype.updateSortValue = function() {\n  var sortValueTotal = 0;\n  this.flatGraph.forEach( function( item ) {\n    item.updateSortValue();\n    sortValueTotal += item.sortValue;\n  });\n  // average sort value of all points\n  // def not geometrically correct, but works for me\n  this.sortValue = sortValueTotal / this.flatGraph.length;\n\n  if ( this.updateSort ) {\n    this.flatGraph.sort( Anchor.shapeSorter );\n  }\n};\n\n// ----- render ----- //\n\nGroup.prototype.render = function( ctx, renderer ) {\n  if ( !this.visible ) {\n    return;\n  }\n\n  this.flatGraph.forEach( function( item ) {\n    item.render( ctx, renderer );\n  });\n};\n\n// actual group flatGraph only used inside group\nGroup.prototype.updateFlatGraph = function() {\n  // do not include self\n  var flatGraph = [];\n  this.flatGraph = this.addChildFlatGraph( flatGraph );\n};\n\n// do not include children, group handles rendering & sorting internally\nGroup.prototype.getFlatGraph = function() {\n  return [ this ];\n};\n\nreturn Group;\n\n}));\n/**\n * Rect\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory( require('./shape') );\n  } else {\n    // browser global\n    var Zdog = root.Zdog;\n    Zdog.Rect = factory( Zdog.Shape );\n  }\n}( this, function factory( Shape ) {\n\nvar Rect = Shape.subclass({\n  width: 1,\n  height: 1,\n});\n\nRect.prototype.setPath = function() {\n  var x = this.width / 2;\n  var y = this.height / 2;\n  /* eslint key-spacing: \"off\" */\n  this.path = [\n    { x: -x, y: -y },\n    { x:  x, y: -y },\n    { x:  x, y:  y },\n    { x: -x, y:  y },\n  ];\n};\n\nreturn Rect;\n\n}));\n/**\n * RoundedRect\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory( require('./shape') );\n  } else {\n    // browser global\n    var Zdog = root.Zdog;\n    Zdog.RoundedRect = factory( Zdog.Shape );\n  }\n}( this, function factory( Shape ) {\n\nvar RoundedRect = Shape.subclass({\n  width: 1,\n  height: 1,\n  cornerRadius: 0.25,\n  closed: false,\n});\n\nRoundedRect.prototype.setPath = function() {\n  /* eslint\n     id-length: [ \"error\", { \"min\": 2, \"exceptions\": [ \"x\", \"y\" ] }],\n     key-spacing: \"off\" */\n  var xA = this.width / 2;\n  var yA = this.height / 2;\n  var shortSide = Math.min( xA, yA );\n  var cornerRadius = Math.min( this.cornerRadius, shortSide );\n  var xB = xA - cornerRadius;\n  var yB = yA - cornerRadius;\n  var path = [\n    // top right corner\n    { x: xB, y: -yA },\n    { arc: [\n      { x: xA, y: -yA },\n      { x: xA, y: -yB },\n    ]},\n  ];\n  // bottom right corner\n  if ( yB ) {\n    path.push({ x: xA, y: yB });\n  }\n  path.push({ arc: [\n    { x: xA, y:  yA },\n    { x: xB, y:  yA },\n  ]});\n  // bottom left corner\n  if ( xB ) {\n    path.push({ x: -xB, y: yA });\n  }\n  path.push({ arc: [\n    { x: -xA, y:  yA },\n    { x: -xA, y:  yB },\n  ]});\n  // top left corner\n  if ( yB ) {\n    path.push({ x: -xA, y: -yB });\n  }\n  path.push({ arc: [\n    { x: -xA, y: -yA },\n    { x: -xB, y: -yA },\n  ]});\n\n  // back to top right corner\n  if ( xB ) {\n    path.push({ x: xB, y: -yA });\n  }\n\n  this.path = path;\n};\n\nreturn RoundedRect;\n\n}));\n/**\n * Ellipse\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory( require('./shape') );\n  } else {\n    // browser global\n    var Zdog = root.Zdog;\n    Zdog.Ellipse = factory( Zdog.Shape );\n  }\n\n}( this, function factory( Shape ) {\n\nvar Ellipse = Shape.subclass({\n  diameter: 1,\n  width: undefined,\n  height: undefined,\n  quarters: 4,\n  closed: false,\n});\n\nEllipse.prototype.setPath = function() {\n  var width = this.width != undefined ? this.width : this.diameter;\n  var height = this.height != undefined ? this.height : this.diameter;\n  var x = width / 2;\n  var y = height / 2;\n  this.path = [\n    { x: 0, y: -y },\n    { arc: [ // top right\n      { x: x, y: -y },\n      { x: x, y: 0 },\n    ]},\n  ];\n  // bottom right\n  if ( this.quarters > 1 ) {\n    this.path.push({ arc: [\n      { x: x, y: y },\n      { x: 0, y: y },\n    ]});\n  }\n  // bottom left\n  if ( this.quarters > 2 ) {\n    this.path.push({ arc: [\n      { x: -x, y: y },\n      { x: -x, y: 0 },\n    ]});\n  }\n  // top left\n  if ( this.quarters > 3 ) {\n    this.path.push({ arc: [\n      { x: -x, y: -y },\n      { x: 0, y: -y },\n    ]});\n  }\n};\n\nreturn Ellipse;\n\n}));\n/**\n * Shape\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory( require('./boilerplate'), require('./shape') );\n  } else {\n    // browser global\n    var Zdog = root.Zdog;\n    Zdog.Polygon = factory( Zdog, Zdog.Shape );\n  }\n}( this, function factory( utils, Shape ) {\n\nvar Polygon = Shape.subclass({\n  sides: 3,\n  radius: 0.5,\n});\n\nvar TAU = utils.TAU;\n\nPolygon.prototype.setPath = function() {\n  this.path = [];\n  for ( var i=0; i < this.sides; i++ ) {\n    var theta = i/this.sides * TAU - TAU/4;\n    var x = Math.cos( theta ) * this.radius;\n    var y = Math.sin( theta ) * this.radius;\n    this.path.push({ x: x, y: y });\n  }\n};\n\nreturn Polygon;\n\n}));\n/**\n * Hemisphere composite shape\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory( require('./boilerplate'), require('./vector'),\n        require('./anchor'), require('./ellipse') );\n  } else {\n    // browser global\n    var Zdog = root.Zdog;\n    Zdog.Hemisphere = factory( Zdog, Zdog.Vector, Zdog.Anchor, Zdog.Ellipse );\n  }\n}( this, function factory( utils, Vector, Anchor, Ellipse ) {\n\nvar Hemisphere = Ellipse.subclass({\n  fill: true,\n});\n\nvar TAU = utils.TAU;\n\nHemisphere.prototype.create = function(/* options */) {\n  // call super\n  Ellipse.prototype.create.apply( this, arguments );\n  // composite shape, create child shapes\n  this.apex = new Anchor({\n    addTo: this,\n    translate: { z: this.diameter/2 },\n  });\n  // vector used for calculation\n  this.renderCentroid = new Vector();\n};\n\nHemisphere.prototype.updateSortValue = function() {\n  // centroid of hemisphere is 3/8 between origin and apex\n  this.renderCentroid.set( this.renderOrigin )\n    .lerp( this.apex.renderOrigin, 3/8 );\n  this.sortValue = this.renderCentroid.z;\n};\n\nHemisphere.prototype.render = function( ctx, renderer ) {\n  this.renderDome( ctx, renderer );\n  // call super\n  Ellipse.prototype.render.apply( this, arguments );\n};\n\nHemisphere.prototype.renderDome = function( ctx, renderer ) {\n  if ( !this.visible ) {\n    return;\n  }\n  var elem = this.getDomeRenderElement( ctx, renderer );\n  var contourAngle = Math.atan2( this.renderNormal.y, this.renderNormal.x );\n  var domeRadius = this.diameter/2 * this.renderNormal.magnitude();\n  var x = this.renderOrigin.x;\n  var y = this.renderOrigin.y;\n\n  if ( renderer.isCanvas ) {\n    // canvas\n    var startAngle = contourAngle + TAU/4;\n    var endAngle = contourAngle - TAU/4;\n    ctx.beginPath();\n    ctx.arc( x, y, domeRadius, startAngle, endAngle );\n  } else if ( renderer.isSvg ) {\n    // svg\n    contourAngle = (contourAngle - TAU/4) / TAU * 360;\n    this.domeSvgElement.setAttribute( 'd', 'M ' + -domeRadius + ',0 A ' +\n        domeRadius + ',' + domeRadius + ' 0 0 1 ' + domeRadius + ',0' );\n    this.domeSvgElement.setAttribute( 'transform',\n        'translate(' + x + ',' + y + ' ) rotate(' + contourAngle + ')' );\n  }\n\n  renderer.stroke( ctx, elem, this.stroke, this.color, this.getLineWidth() );\n  renderer.fill( ctx, elem, this.fill, this.color );\n  renderer.end( ctx, elem );\n};\n\nvar svgURI = 'http://www.w3.org/2000/svg';\n\nHemisphere.prototype.getDomeRenderElement = function( ctx, renderer ) {\n  if ( !renderer.isSvg ) {\n    return;\n  }\n  if ( !this.domeSvgElement ) {\n    // create svgElement\n    this.domeSvgElement = document.createElementNS( svgURI, 'path');\n    this.domeSvgElement.setAttribute( 'stroke-linecap', 'round' );\n    this.domeSvgElement.setAttribute( 'stroke-linejoin', 'round' );\n  }\n  return this.domeSvgElement;\n};\n\nreturn Hemisphere;\n\n}));\n/**\n * Cylinder composite shape\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory( require('./boilerplate'),\n        require('./path-command'), require('./shape'), require('./group'),\n        require('./ellipse') );\n  } else {\n    // browser global\n    var Zdog = root.Zdog;\n    Zdog.Cylinder = factory( Zdog, Zdog.PathCommand, Zdog.Shape,\n        Zdog.Group, Zdog.Ellipse );\n  }\n}( this, function factory( utils, PathCommand, Shape, Group, Ellipse ) {\n\nfunction noop() {}\n\n// ----- CylinderGroup ----- //\n\nvar CylinderGroup = Group.subclass({\n  color: '#333',\n  updateSort: true,\n});\n\nCylinderGroup.prototype.create = function() {\n  Group.prototype.create.apply( this, arguments );\n  this.pathCommands = [\n    new PathCommand( 'move', [ {} ] ),\n    new PathCommand( 'line', [ {} ] ),\n  ];\n};\n\nCylinderGroup.prototype.render = function( ctx, renderer ) {\n  this.renderCylinderSurface( ctx, renderer );\n  Group.prototype.render.apply( this, arguments );\n};\n\nCylinderGroup.prototype.renderCylinderSurface = function( ctx, renderer ) {\n  if ( !this.visible ) {\n    return;\n  }\n  // render cylinder surface\n  var elem = this.getRenderElement( ctx, renderer );\n  var frontBase = this.frontBase;\n  var rearBase = this.rearBase;\n  var scale = frontBase.renderNormal.magnitude();\n  var strokeWidth = frontBase.diameter * scale + frontBase.getLineWidth();\n  // set path command render points\n  this.pathCommands[0].renderPoints[0].set( frontBase.renderOrigin );\n  this.pathCommands[1].renderPoints[0].set( rearBase.renderOrigin );\n\n  if ( renderer.isCanvas ) {\n    ctx.lineCap = 'butt'; // nice\n  }\n  renderer.renderPath( ctx, elem, this.pathCommands );\n  renderer.stroke( ctx, elem, true, this.color, strokeWidth );\n  renderer.end( ctx, elem );\n\n  if ( renderer.isCanvas ) {\n    ctx.lineCap = 'round'; // reset\n  }\n};\n\nvar svgURI = 'http://www.w3.org/2000/svg';\n\nCylinderGroup.prototype.getRenderElement = function( ctx, renderer ) {\n  if ( !renderer.isSvg ) {\n    return;\n  }\n  if ( !this.svgElement ) {\n    // create svgElement\n    this.svgElement = document.createElementNS( svgURI, 'path');\n  }\n  return this.svgElement;\n};\n\n// prevent double-creation in parent.copyGraph()\n// only create in Cylinder.create()\nCylinderGroup.prototype.copyGraph = noop;\n\n// ----- CylinderEllipse ----- //\n\nvar CylinderEllipse = Ellipse.subclass();\n\nCylinderEllipse.prototype.copyGraph = noop;\n\n// ----- Cylinder ----- //\n\nvar Cylinder = Shape.subclass({\n  diameter: 1,\n  length: 1,\n  frontFace: undefined,\n  fill: true,\n});\n\nvar TAU = utils.TAU;\n\nCylinder.prototype.create = function(/* options */) {\n  // call super\n  Shape.prototype.create.apply( this, arguments );\n  // composite shape, create child shapes\n  // CylinderGroup to render cylinder surface then bases\n  this.group = new CylinderGroup({\n    addTo: this,\n    color: this.color,\n    visible: this.visible,\n  });\n  var baseZ = this.length/2;\n  var baseColor = this.backface || true;\n  // front outside base\n  this.frontBase = this.group.frontBase = new Ellipse({\n    addTo: this.group,\n    diameter: this.diameter,\n    translate: { z: baseZ },\n    rotate: { y: TAU/2 },\n    color: this.color,\n    stroke: this.stroke,\n    fill: this.fill,\n    backface: this.frontFace || baseColor,\n    visible: this.visible,\n  });\n  // back outside base\n  this.rearBase = this.group.rearBase = this.frontBase.copy({\n    translate: { z: -baseZ },\n    rotate: { y: 0 },\n    backface: baseColor,\n  });\n};\n\n// Cylinder shape does not render anything\nCylinder.prototype.render = function() {};\n\n// ----- set child properties ----- //\n\nvar childProperties = [ 'stroke', 'fill', 'color', 'visible' ];\nchildProperties.forEach( function( property ) {\n  // use proxy property for custom getter & setter\n  var _prop = '_' + property;\n  Object.defineProperty( Cylinder.prototype, property, {\n    get: function() {\n      return this[ _prop ];\n    },\n    set: function( value ) {\n      this[ _prop ] = value;\n      // set property on children\n      if ( this.frontBase ) {\n        this.frontBase[ property ] = value;\n        this.rearBase[ property ] = value;\n        this.group[ property ] = value;\n      }\n    },\n  });\n});\n\n// TODO child property setter for backface, frontBaseColor, & rearBaseColor\n\nreturn Cylinder;\n\n}));\n/**\n * Cone composite shape\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory( require('./boilerplate'), require('./vector'),\n        require('./path-command'), require('./anchor'), require('./ellipse') );\n  } else {\n    // browser global\n    var Zdog = root.Zdog;\n    Zdog.Cone = factory( Zdog, Zdog.Vector, Zdog.PathCommand,\n        Zdog.Anchor, Zdog.Ellipse );\n  }\n}( this, function factory( utils, Vector, PathCommand, Anchor, Ellipse ) {\n\nvar Cone = Ellipse.subclass({\n  length: 1,\n  fill: true,\n});\n\nvar TAU = utils.TAU;\n\nCone.prototype.create = function(/* options */) {\n  // call super\n  Ellipse.prototype.create.apply( this, arguments );\n  // composite shape, create child shapes\n  this.apex = new Anchor({\n    addTo: this,\n    translate: { z: this.length },\n  });\n\n  // vectors used for calculation\n  this.renderApex = new Vector();\n  this.renderCentroid = new Vector();\n  this.tangentA = new Vector();\n  this.tangentB = new Vector();\n\n  this.surfacePathCommands = [\n    new PathCommand( 'move', [ {} ] ), // points set in renderConeSurface\n    new PathCommand( 'line', [ {} ] ),\n    new PathCommand( 'line', [ {} ] ),\n  ];\n};\n\nCone.prototype.updateSortValue = function() {\n  // center of cone is one third of its length\n  this.renderCentroid.set( this.renderOrigin )\n    .lerp( this.apex.renderOrigin, 1/3 );\n  this.sortValue = this.renderCentroid.z;\n};\n\nCone.prototype.render = function( ctx, renderer ) {\n  this.renderConeSurface( ctx, renderer );\n  Ellipse.prototype.render.apply( this, arguments );\n};\n\nCone.prototype.renderConeSurface = function( ctx, renderer ) {\n  if ( !this.visible ) {\n    return;\n  }\n  this.renderApex.set( this.apex.renderOrigin )\n    .subtract( this.renderOrigin );\n\n  var scale = this.renderNormal.magnitude();\n  var apexDistance = this.renderApex.magnitude2d();\n  var normalDistance = this.renderNormal.magnitude2d();\n  // eccentricity\n  var eccenAngle = Math.acos( normalDistance / scale );\n  var eccen = Math.sin( eccenAngle );\n  var radius = this.diameter/2 * scale;\n  // does apex extend beyond eclipse of face\n  var isApexVisible = radius * eccen < apexDistance;\n  if ( !isApexVisible ) {\n    return;\n  }\n  // update tangents\n  var apexAngle = Math.atan2( this.renderNormal.y, this.renderNormal.x ) +\n      TAU/2;\n  var projectLength = apexDistance / eccen;\n  var projectAngle = Math.acos( radius / projectLength );\n  // set tangent points\n  var tangentA = this.tangentA;\n  var tangentB = this.tangentB;\n\n  tangentA.x = Math.cos( projectAngle ) * radius * eccen;\n  tangentA.y = Math.sin( projectAngle ) * radius;\n\n  tangentB.set( this.tangentA );\n  tangentB.y *= -1;\n\n  tangentA.rotateZ( apexAngle );\n  tangentB.rotateZ( apexAngle );\n  tangentA.add( this.renderOrigin );\n  tangentB.add( this.renderOrigin );\n\n  this.setSurfaceRenderPoint( 0, tangentA );\n  this.setSurfaceRenderPoint( 1, this.apex.renderOrigin );\n  this.setSurfaceRenderPoint( 2, tangentB );\n\n  // render\n  var elem = this.getSurfaceRenderElement( ctx, renderer );\n  renderer.renderPath( ctx, elem, this.surfacePathCommands );\n  renderer.stroke( ctx, elem, this.stroke, this.color, this.getLineWidth() );\n  renderer.fill( ctx, elem, this.fill, this.color );\n  renderer.end( ctx, elem );\n};\n\nvar svgURI = 'http://www.w3.org/2000/svg';\n\nCone.prototype.getSurfaceRenderElement = function( ctx, renderer ) {\n  if ( !renderer.isSvg ) {\n    return;\n  }\n  if ( !this.surfaceSvgElement ) {\n    // create svgElement\n    this.surfaceSvgElement = document.createElementNS( svgURI, 'path');\n    this.surfaceSvgElement.setAttribute( 'stroke-linecap', 'round' );\n    this.surfaceSvgElement.setAttribute( 'stroke-linejoin', 'round' );\n  }\n  return this.surfaceSvgElement;\n};\n\nCone.prototype.setSurfaceRenderPoint = function( index, point ) {\n  var renderPoint = this.surfacePathCommands[ index ].renderPoints[0];\n  renderPoint.set( point );\n};\n\nreturn Cone;\n\n}));\n/**\n * Box composite shape\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory( require('./boilerplate'), require('./anchor'),\n        require('./shape'), require('./rect') );\n  } else {\n    // browser global\n    var Zdog = root.Zdog;\n    Zdog.Box = factory( Zdog, Zdog.Anchor, Zdog.Shape, Zdog.Rect );\n  }\n}( this, function factory( utils, Anchor, Shape, Rect ) {\n\n// ----- BoxRect ----- //\n\nvar BoxRect = Rect.subclass();\n// prevent double-creation in parent.copyGraph()\n// only create in Box.create()\nBoxRect.prototype.copyGraph = function() {};\n\n// ----- Box ----- //\n\nvar TAU = utils.TAU;\nvar faceNames = [\n  'frontFace',\n  'rearFace',\n  'leftFace',\n  'rightFace',\n  'topFace',\n  'bottomFace',\n];\n\nvar boxDefaults = utils.extend( {}, Shape.defaults );\ndelete boxDefaults.path;\nfaceNames.forEach( function( faceName ) {\n  boxDefaults[ faceName ] = true;\n});\nutils.extend( boxDefaults, {\n  width: 1,\n  height: 1,\n  depth: 1,\n  fill: true,\n});\n\nvar Box = Anchor.subclass( boxDefaults );\n\nBox.prototype.create = function( options ) {\n  Anchor.prototype.create.call( this, options );\n  this.updatePath();\n  // HACK reset fill to trigger face setter\n  this.fill = this.fill;\n};\n\nBox.prototype.updatePath = function() {\n  // reset all faces to trigger setters\n  faceNames.forEach( function( faceName ) {\n    this[ faceName ] = this[ faceName ];\n  }, this );\n};\n\nfaceNames.forEach( function( faceName ) {\n  var _faceName = '_' + faceName;\n  Object.defineProperty( Box.prototype, faceName, {\n    get: function() {\n      return this[ _faceName ];\n    },\n    set: function( value ) {\n      this[ _faceName ] = value;\n      this.setFace( faceName, value );\n    },\n  });\n});\n\nBox.prototype.setFace = function( faceName, value ) {\n  var rectProperty = faceName + 'Rect';\n  var rect = this[ rectProperty ];\n  // remove if false\n  if ( !value ) {\n    this.removeChild( rect );\n    return;\n  }\n  // update & add face\n  var options = this.getFaceOptions( faceName );\n  options.color = typeof value == 'string' ? value : this.color;\n\n  if ( rect ) {\n    // update previous\n    rect.setOptions( options );\n  } else {\n    // create new\n    rect = this[ rectProperty ] = new BoxRect( options );\n  }\n  rect.updatePath();\n  this.addChild( rect );\n};\n\nBox.prototype.getFaceOptions = function( faceName ) {\n  return {\n    frontFace: {\n      width: this.width,\n      height: this.height,\n      translate: { z: this.depth/2 },\n    },\n    rearFace: {\n      width: this.width,\n      height: this.height,\n      translate: { z: -this.depth/2 },\n      rotate: { y: TAU/2 },\n    },\n    leftFace: {\n      width: this.depth,\n      height: this.height,\n      translate: { x: -this.width/2 },\n      rotate: { y: -TAU/4 },\n    },\n    rightFace: {\n      width: this.depth,\n      height: this.height,\n      translate: { x: this.width/2 },\n      rotate: { y: TAU/4 },\n    },\n    topFace: {\n      width: this.width,\n      height: this.depth,\n      translate: { y: -this.height/2 },\n      rotate: { x: -TAU/4 },\n    },\n    bottomFace: {\n      width: this.width,\n      height: this.depth,\n      translate: { y: this.height/2 },\n      rotate: { x: TAU/4 },\n    },\n  }[ faceName ];\n};\n\n// ----- set face properties ----- //\n\nvar childProperties = [ 'color', 'stroke', 'fill', 'backface', 'front',\n  'visible' ];\nchildProperties.forEach( function( property ) {\n  // use proxy property for custom getter & setter\n  var _prop = '_' + property;\n  Object.defineProperty( Box.prototype, property, {\n    get: function() {\n      return this[ _prop ];\n    },\n    set: function( value ) {\n      this[ _prop ] = value;\n      faceNames.forEach( function( faceName ) {\n        var rect = this[ faceName + 'Rect' ];\n        var isFaceColor = typeof this[ faceName ] == 'string';\n        var isColorUnderwrite = property == 'color' && isFaceColor;\n        if ( rect && !isColorUnderwrite ) {\n          rect[ property ] = value;\n        }\n      }, this );\n    },\n  });\n});\n\nreturn Box;\n\n}));\n/**\n * Index\n */\n\n( function( root, factory ) {\n  // module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory(\n        require('./boilerplate'),\n        require('./canvas-renderer'),\n        require('./svg-renderer'),\n        require('./vector'),\n        require('./anchor'),\n        require('./dragger'),\n        require('./illustration'),\n        require('./path-command'),\n        require('./shape'),\n        require('./group'),\n        require('./rect'),\n        require('./rounded-rect'),\n        require('./ellipse'),\n        require('./polygon'),\n        require('./hemisphere'),\n        require('./cylinder'),\n        require('./cone'),\n        require('./box')\n    );\n  } else if ( typeof define == 'function' && define.amd ) {\n    /* globals define */ // AMD\n    define( 'zdog', [], root.Zdog );\n  }\n})( this, function factory( Zdog, CanvasRenderer, SvgRenderer, Vector, Anchor,\n    Dragger, Illustration, PathCommand, Shape, Group, Rect, RoundedRect,\n    Ellipse, Polygon, Hemisphere, Cylinder, Cone, Box ) {\n\n      Zdog.CanvasRenderer = CanvasRenderer;\n      Zdog.SvgRenderer = SvgRenderer;\n      Zdog.Vector = Vector;\n      Zdog.Anchor = Anchor;\n      Zdog.Dragger = Dragger;\n      Zdog.Illustration = Illustration;\n      Zdog.PathCommand = PathCommand;\n      Zdog.Shape = Shape;\n      Zdog.Group = Group;\n      Zdog.Rect = Rect;\n      Zdog.RoundedRect = RoundedRect;\n      Zdog.Ellipse = Ellipse;\n      Zdog.Polygon = Polygon;\n      Zdog.Hemisphere = Hemisphere;\n      Zdog.Cylinder = Cylinder;\n      Zdog.Cone = Cone;\n      Zdog.Box = Box;\n\n      return Zdog;\n});"]}